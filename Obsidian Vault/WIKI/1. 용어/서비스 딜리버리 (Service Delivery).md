#용어 #MSA

마이크로서비스 아키텍처(MSA)로 구성되어 있는 서비스들은 각자 다른 IP와 Port를 가지고 있다 이러한 서로 다른 서비스들의 IP와 Port 정보에 대해서 저장하고 관리할 필요가 있는데 이것을 Service Discovery라고 한다.

-----------


## 서비스딜리버리를 사용해야하는 이유 
REST API 또는 Thrift API가 있는 서비스를 호출하는 코드를 작성한다고 할떄, 요청을 하려면 코드가 서비스 인스턴스의 네트워크 위치(IP 주소 및 포트)를 알아야 한다. 
물리적 하드웨어에서 실행되는 `기존 애플리케이션에서 서비스 인스턴스의 네트워크 위치는 상대적으로 정적`이다. (예를 들어 코드는 때때로 업데이트되는 구성 파일에서 네트워크 위치를 읽을 수있음) 
그러나 `클라우드 기반 마이크로서비스 애플리케이션에서는 인스턴스 집합과 해당 IP 주소가 지속적으로 변경`되기 때문에 서비스 검색이 어렵다. (각 서비스 인스턴스에는 동적으로 할당된 네트워크 위치가 있고, 서비스 인스턴스 집합은 자동 크기 조정, 장애 및 업그레이드로 인해 동적으로 변경된다.) 결과적으로 클라이언트 코드는 보다 정교한 서비스 검색 메커니즘을 사용해야 하는데.. 
이 검색 방법에는 크게 2가지가 있다. 

1) Client‑side discovery (클라이언트측 검색)
2) Server‑side discovery (서버측 검색)


## Client-side Discovery

클라이언트가 사용 가능한 서비스 인스턴스의 네트워크 위치를 결정, 서비스 인스턴스에 대한 로드 균형 조정 요청을 담당.

클라이언트는 `서비스 레지스트리(사용 가능한 서비스 인스턴스의 데이터베이스)를 쿼리`. 클라이언트 측 서비스 검색을 통해 사용 가능한 서비스 인스턴스의 네트워크 위치를 결정하고 서비스 인스턴스 간에 요청 부하를 분산.

서비스 인스턴스의 네트워크 위치는 시작할 때 서비스 레지스트리에 등록되고, 인스턴스가 종료되면 서비스 레지스트리에서 제거. 서비스인스턴스의 내용은 일반적으로 하트비트 메커니즘을 사용하여 주기적으로 리프래쉬.

- 장점) 비교적 간단하며 서비스 레지스트리를 제외하고 다른 이동 부분이 없음. 
- 단점) 클라이언트를 서비스 레지스트리와 결합. 서비스 클라이언트에서 사용하는 각 프로그래밍 언어 및 프레임워크에 대한 클라이언트 측 서비스 검색 논리 구현필요.

![[Pasted image 20221222154714.png]]


## Server‑side discovery 

서버 측 서비스 검색을 통해 `로드 밸런서는 서비스 위치에 대한 서비스 레지스트리를 쿼리`. 클라이언트는 로드 밸런서와만 상호 작용. (클라이언트는 로드 밸런서를 통해 서비스에 요청) 
부하 분산 장치는 서비스 레지스트리를 쿼리하고` 각 요청을 사용 가능한 서비스 인스턴스로 라우팅`. 클라이언트 쪽 검색과 마찬가지로 서비스 인스턴스는 서비스 레지스트리에 등록 및 등록 취소.

서버 측 검색 패턴에는 몇 가지 장점과 단점이 있습니다. 이 패턴의 큰 이점 중 하나는 
- 장점> 검색 세부 정보가 클라이언트에서 추상화 : 클라이언트는 단순히 로드 밸런서에 요청만. 이렇게 하면 서비스 클라이언트에서 사용하는 각 프로그래밍 언어 및 프레임워크에 대한 검색 논리를 구현할 필요가 없음. 
- 장점> 일부 배포 환경에서는 이 기능을 무료로 제공. 
- 단점> 배포 환경에서 로드 밸런서를 제공하지 않는 한 설정/관리 필요

![[Pasted image 20221222161311.png]]
- 출처 : https://www.nginx.com/blog/service-discovery-in-a-microservices-architecture/


